<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² - Ú©Ù…Ù¾ Ø®Ø±Ø§Ø³Ø§Ù†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/custom.css">
    <style>
        .detail-header {
            background: linear-gradient(135deg, var(--color-primary-600) 0%, var(--color-primary-800) 100%);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            color: white;
            margin-bottom: var(--space-6);
        }
        .detail-avatar {
            width: 80px; height: 80px;
            background: rgba(255,255,255,0.2);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }
        .detail-name { font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); margin-bottom: var(--space-1); }
        .detail-meta { opacity: 0.8; font-size: var(--font-size-sm); }
        .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-4); }
        @media (max-width: 767px) { .info-grid { grid-template-columns: 1fr; } }
        .info-item { padding: var(--space-4); background: var(--bg-secondary); border-radius: var(--radius-lg); }
        .info-label { font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-1); }
        .info-value { font-weight: var(--font-weight-semibold); color: var(--text-primary); }
    </style>
</head>
<body>
    <nav class="navbar-app">
        <a class="navbar-brand" href="index.html"><span class="navbar-brand-icon">ğŸ¤¸â€â™‚ï¸</span>Ú©Ù…Ù¾ Ø®Ø±Ø§Ø³Ø§Ù†</a>
        <div class="navbar-actions">
            <a href="students.html" class="btn-app btn-app--secondary btn-app--sm"><i class="bi bi-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</a>
            <button type="button" class="theme-switch" id="themeSwitch" title="ØªØºÛŒÛŒØ± ØªÙ…">
                <span class="theme-switch-icons"><span class="theme-switch-icon theme-switch-icon--sun">â˜€ï¸</span><span class="theme-switch-icon theme-switch-icon--moon">ğŸŒ™</span></span>
                <span class="theme-switch-slider"></span>
            </button>
        </div>
    </nav>
    <main class="app-main" style="margin-right: 0;">
        <div class="container-app">
            <div id="studentDetail">
                <div class="text-center py-5"><div class="spinner-app mx-auto"></div></div>
            </div>
            <div class="card-app mt-4 animate-slideUp">
                <div class="card-app-header">
                    <h2 class="card-app-title"><i class="bi bi-clock-history"></i> ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h2>
                </div>
                <div class="card-app-body p-0">
                    <div class="table-responsive" id="registrationsList">
                        <div class="text-center py-4"><div class="spinner-app mx-auto"></div></div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/jalali.js"></script>

    <script>
        if (!checkAuth()) window.location.href = 'login.html';
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('id');

        async function loadStudentDetail() {
            try {
                const data = await APIClient.get(`students.php?id=${studentId}`);
                if (data.success) {
                    const s = data.data;
                    document.getElementById('studentDetail').innerHTML = `
                        <div class="detail-header animate-slideUp">
                            <div class="d-flex align-items-center gap-4">
                                <div class="detail-avatar">ğŸ‘¤</div>
                                <div>
                                    <div class="detail-name">${s.first_name} ${s.last_name}</div>
                                    <div class="detail-meta"><i class="bi bi-person-badge me-1"></i> Ù†Ø§Ù… Ù¾Ø¯Ø±: ${s.father_name || '-'}</div>
                                </div>
                                <div class="ms-auto">
                                    <span class="badge-app ${s.status === 'active' ? 'badge-app--success' : 'badge-app--gray'}" style="font-size: 14px; padding: 8px 16px;">
                                        ${s.status === 'active' ? 'âœ“ ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="card-app animate-slideUp" style="animation-delay: 100ms;">
                            <div class="card-app-header"><h2 class="card-app-title"><i class="bi bi-info-circle"></i> Ø§Ø·Ù„Ø§Ø¹Ø§Øª</h2></div>
                            <div class="card-app-body">
                                <div class="info-grid">
                                    <div class="info-item"><div class="info-label"><i class="bi bi-telephone"></i> Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</div><div class="info-value">${s.contact_number || '-'}</div></div>
                                    <div class="info-item"><div class="info-label"><i class="bi bi-calendar"></i> ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</div><div class="info-value">${formatJalaliDate(s.created_at_jalali)}</div></div>
                                    <div class="info-item"><div class="info-label"><i class="bi bi-sticky"></i> ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</div><div class="info-value">${s.notes || '-'}</div></div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                const regData = await APIClient.get(`students.php?id=${studentId}&action=registrations`);
                if (regData.success) {
                    if (regData.data.length === 0) {
                        document.getElementById('registrationsList').innerHTML = '<div class="table-empty"><div class="table-empty-icon">ğŸ“‹</div><div class="table-empty-text">Ù‡ÛŒÚ† Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div></div>';
                    } else {
                        document.getElementById('registrationsList').innerHTML = `
                            <table class="table-app">
                                <thead><tr><th>Ù…Ø±Ø¨ÛŒ</th><th>Ø²Ù…Ø§Ù† Ú©Ù„Ø§Ø³</th><th>Ù…Ø¨Ù„Øº</th><th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th><th>Ù¾Ø§ÛŒØ§Ù†</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>ÙØ§Ú©ØªÙˆØ±</th></tr></thead>
                                <tbody>
                                    ${regData.data.map(r => `
                                        <tr>
                                            <td><strong>${r.coach_first_name} ${r.coach_last_name}</strong></td>
                                            <td><span class="badge-app badge-app--primary">${r.time_slot_name}</span></td>
                                            <td class="text-success">${formatCurrency(r.fee_amount)}</td>
                                            <td>${formatJalaliDate(r.registration_date_jalali)}</td>
                                            <td>${formatJalaliDate(r.end_date_jalali)}</td>
                                            <td><span class="badge-app ${r.status === 'active' ? 'badge-app--success' : 'badge-app--gray'}">${r.status === 'active' ? 'ÙØ¹Ø§Ù„' : 'Ù…Ù†Ù‚Ø¶ÛŒ'}</span></td>
                                            <td>${r.invoice_number ? `<a href="invoice.html?id=${r.invoice_id}" target="_blank" class="btn-app btn-app--primary btn-app--sm"><i class="bi bi-receipt"></i></a>` : '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `;
                    }
                }
            } catch (error) { showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª', 'danger'); }
        }
        loadStudentDetail();
        initDarkMode();
    </script>
</body>
</html>
