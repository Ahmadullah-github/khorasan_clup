# Sports Camp Management System

یک سیستم مدیریت کامل برای اردوگاه ورزشی با قابلیت کار آفلاین، پشتیبانی کامل از تاریخ جلالی (شمسی)، و رابط کاربری RTL برای زبان دری.

## ویژگی‌های اصلی

- ✅ **کار آفلاین**: عملیات پایه (مشاهده لیست‌ها، افزودن رکوردها) بدون اینترنت کار می‌کند
- ✅ **طراحی واکنش‌گرا**: از موبایل تا دسکتاپ
- ✅ **حالت تاریک/روشن**: با قابلیت ذخیره تنظیمات
- ✅ **تاریخ جلالی کامل**: از Hamal تا Hoot با نام‌های ماه به دری
- ✅ **صفحه‌بندی و جستجو**: در تمام صفحات لیست
- ✅ **دکمه بازگشت به داشبورد**: در تمام صفحات
- ✅ **ورود امن**: با قفل حساب پس از تلاش‌های ناموفق
- ✅ **مدیریت کاربران**: فقط برای ادمین

## تکنولوژی‌های استفاده شده

### Frontend
- HTML5, CSS3, JavaScript (Vanilla)
- Bootstrap 5.3+
- Persian Datepicker (برای انتخاب تاریخ جلالی)
- IndexedDB (برای پشتیبانی آفلاین)

### Backend
- PHP 7.4+
- MySQL 5.7+
- PDO با Prepared Statements
- Password Hashing (BCRYPT)

## نصب و راه‌اندازی

### پیش‌نیازها

- PHP 7.4 یا بالاتر
- MySQL 5.7 یا بالاتر
- Apache/Nginx web server
- مرورگر مدرن با پشتیبانی از IndexedDB

### مراحل نصب (راه‌اندازی عمومی)

1. **کلون یا دانلود پروژه**
   ```bash
   git clone <repository-url>
   cd sports-camp-management
   ```

2. **ایجاد دیتابیس**
   ```sql
   CREATE DATABASE khorasan_club CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

3. **اجرای Schema**
   ```bash
   mysql -u root -p khorasan_club < migrations/schema.sql
   ```

4. **وارد کردن داده‌های نمونه**
   ```bash
   mysql -u root -p khorasan_club < seed/sample_data.sql
   ```

5. **تنظیمات دیتابیس**
   
   فایل `api/config.php` را باز کرده و اطلاعات دیتابیس را تنظیم کنید:
   ```php
   define('DB_HOST', 'localhost');
   define('DB_NAME', 'khorasan_club');
   define('DB_USER', 'root');
   define('DB_PASS', '');
   ```

6. **تنظیم مجوزهای فایل**
   ```bash
   chmod 755 public/assets/uploads
   chmod 755 public/assets/invoices
   ```

7. **راه‌اندازی سرور**
   
   برای PHP built-in server:
   ```bash
   cd public
   php -S localhost:8000
   ```
   
   یا از Apache/Nginx استفاده کنید و DocumentRoot را به پوشه `public` تنظیم کنید.

8. **دسترسی به سیستم**
   
   مرورگر را باز کرده و به آدرس زیر بروید:
   ```
   http://localhost:8000
   ```

### راه‌اندازی با XAMPP در ویندوز

1. **نصب XAMPP**
   - XAMPP را در مسیر پیش‌فرض یا مثلاً `e:\xampp\` نصب کنید.
   - از XAMPP Control Panel سرویس‌های **Apache** و **MySQL** را Start کنید (همان‌طور که در اسکرین‌شات شما است).

2. **قرار دادن پروژه در htdocs**
   - کل پوشهٔ پروژه (همین پوشه‌ای که شامل `api/`, `public/`, `migrations/` است) را داخل مسیر زیر کپی کنید، مثلاً:
     - `e:\xampp\htdocs\sports-camp\`
   - در این حالت مسیر فایل‌ها به صورت زیر خواهد بود:
     - `e:\xampp\htdocs\sports-camp\public\index.html`
     - `e:\xampp\htdocs\sports-camp\api\config.php`

3. **ایجاد دیتابیس در MySQL (XAMPP)**
   - در مرورگر به آدرس `http://localhost/phpmyadmin` بروید.
   - یک دیتابیس جدید با نام `khorasan_club` و کاراکترست `utf8mb4` و collation `utf8mb4_unicode_ci` بسازید.
   - از تب **Import** فایل‌های زیر را به ترتیب اجرا کنید:
     - `migrations/schema.sql`
     - (اختیاری) `seed/sample_data.sql` برای داده‌های نمونه.

4. **تنظیمات دیتابیس برای XAMPP**
   - در XAMPP به صورت پیش‌فرض کاربر `root` بدون رمز عبور است.
   - مطمئن شوید مقدارهای داخل `api/config.php` به این شکل باشد (یا از مقدارهای پیش‌فرض فعلی استفاده کنید):
     ```php
     define('DB_HOST', 'localhost');
     define('DB_NAME', 'khorasan_club');
     define('DB_USER', 'root');
     define('DB_PASS', '');
     ```

5. **دسترسی به سیستم با XAMPP**
   - ساده‌ترین حالت این است که در مرورگر آدرس زیر را باز کنید:
     ```
     http://localhost/sports-camp/public/
     ```
   - در مراحل بعدی می‌توانید با تعریف VirtualHost در Apache، آدرس تمیزتری مثل `http://sports-camp.local/` داشته باشید (نمونه کانفیگ در مستندات اضافه شده است).

## اطلاعات ورود پیش‌فرض

**نام کاربری:** `admin`  
**رمز عبور:** `admin123`

⚠️ **توجه:** پس از اولین ورود، حتماً رمز عبور را تغییر دهید!

## ساختار پروژه

```
/
├── api/                    # Backend PHP APIs
│   ├── config.php         # تنظیمات دیتابیس و session
│   ├── utils.php          # توابع کمکی (Jalali, validation, audit)
│   ├── auth.php           # احراز هویت
│   ├── students.php       # مدیریت دانش‌آموزان
│   ├── coaches.php        # مدیریت مربیان
│   ├── expenses.php       # مدیریت هزینه‌ها
│   ├── rent.php           # مدیریت اجاره
│   ├── accounting.php     # محاسبه درآمد و پرداخت مربیان
│   ├── reports.php        # گزارش‌ها
│   ├── invoices.php       # فاکتورها
│   └── sync.php           # همگام‌سازی آفلاین
├── public/                # Frontend
│   ├── index.html         # داشبورد
│   ├── login.html         # صفحه ورود
│   ├── students.html      # مدیریت دانش‌آموزان
│   ├── coaches.html      # مدیریت مربیان
│   ├── expenses.html     # مدیریت هزینه‌ها
│   ├── rent.html         # تاریخچه اجاره
│   ├── accounting.html   # درآمد خالص
│   ├── reports.html      # گزارش‌ها
│   ├── css/
│   │   └── custom.css    # استایل‌های سفارشی (RTL, Dark Mode)
│   └── js/
│       ├── app.js         # منطق اصلی برنامه
│       ├── jalali.js      # توابع تاریخ جلالی
│       └── offline.js     # پشتیبانی آفلاین
├── migrations/
│   └── schema.sql        # ساختار دیتابیس
├── seed/
│   └── sample_data.sql   # داده‌های نمونه
└── README.md
```

## ویژگی‌های عملکردی

### احراز هویت
- ورود با نام کاربری و رمز عبور
- قفل حساب پس از 5 تلاش ناموفق (15 دقیقه)
- مدیریت کاربران (فقط ادمین)

### داشبورد
- نمایش KPIs: کل دانش‌آموزان، فعال این ماه، درآمد، هزینه‌ها، درآمد خالص
- هشدار برای دانش‌آموزان نیازمند تمدید
- لینک‌های سریع

### دانش‌آموزان
- ثبت دانش‌آموز جدید با تمام اطلاعات
- لیست دانش‌آموزان موجود با جستجو و صفحه‌بندی
- تمدید سریع ثبت‌نام
- تولید فاکتور و اشتراک‌گذاری واتساپ

### مربیان
- افزودن مربی با زمان‌های کلاس
- مشاهده آمار: تعداد دانش‌آموزان، درآمد جمع‌آوری شده

### هزینه‌ها
- ثبت هزینه با دسته‌بندی
- هزینه‌های اجاره به صورت خودکار در صفحه اجاره نمایش داده می‌شوند

### درآمد خالص و پرداخت مربیان
- محاسبه درآمد خالص (درآمد - هزینه)
- الگوریتم پرداخت:
  - 50% از درآمد خالص به طور مساوی بین مربیان صبح و شب
  - 50% باقیمانده به نسبت درآمد جمع‌آوری شده هر مربی
- لینک‌های قابل کلیک برای مشاهده تراکنش‌های زیربنایی

### گزارش‌ها
- گزارش ماهانه (درآمد، هزینه، درآمد خالص)
- گزارش فعالیت دانش‌آموزان (جدید vs تمدید شده)
- گزارش درآمد مربیان
- خروجی CSV

## الگوریتم پرداخت مربیان

سیستم از الگوریتم پیچیده‌ای برای محاسبه پرداخت مربیان استفاده می‌کند:

1. **محاسبه درآمد خالص**: درآمد کل - هزینه کل
2. **تقسیم 50% اول**: 50% از درآمد خالص به طور مساوی بین تمام مربیانی که کلاس صبح یا شب دارند تقسیم می‌شود
3. **تقسیم 50% دوم**: 50% باقیمانده به نسبت درآمد جمع‌آوری شده هر مربی تقسیم می‌شود

این الگوریتم اطمینان می‌دهد که مربیان صبح و شب اولویت دارند، در حالی که مربیان بعد از ظهر نیز بر اساس سهم خود پرداخت می‌شوند.

## پشتیبانی آفلاین

سیستم از IndexedDB برای ذخیره‌سازی محلی استفاده می‌کند:

- **خواندن**: ابتدا از IndexedDB، سپس از API
- **نوشتن**: ذخیره در IndexedDB + افزودن به صف همگام‌سازی
- **همگام‌سازی**: هنگام آنلاین شدن، تغییرات به سرور ارسال می‌شوند

## امنیت

- ✅ Prepared Statements برای جلوگیری از SQL Injection
- ✅ Password Hashing با BCRYPT
- ✅ CSRF Token برای فرم‌ها
- ✅ Input Sanitization
- ✅ Session Timeout (30 دقیقه)
- ✅ Audit Logs برای تمام تغییرات

## تاریخ جلالی

تمام تاریخ‌ها در سیستم به صورت جلالی (شمسی) ذخیره و نمایش داده می‌شوند:

- نام ماه‌ها به دری: Hamal, Saur, Jawza, Saratan, Asad, Sonbola, Mizan, Aqrab, Qaws, Jadi, Dalv, Hoot
- فرمت ذخیره‌سازی: YYYY-MM-DD (جلالی)
- فرمت نمایش: "DD Month YYYY" (مثال: "15 Hamal 1403")

## معیارهای پذیرش

- ✅ ادمین می‌تواند وارد شود و کاربران را مدیریت کند
- ✅ ثبت دانش‌آموز کار می‌کند و تاریخ جلالی ذخیره می‌شود
- ✅ چاپ فاکتور و اشتراک‌گذاری واتساپ کار می‌کند
- ✅ مربیان می‌توانند با چندین زمان کلاس افزوده شوند
- ✅ ثبت‌نام دانش‌آموزان به مربیان و زمان‌ها لینک می‌شود
- ✅ هزینه‌ها شامل اجاره ثبت می‌شوند و در هر دو صفحه نمایش داده می‌شوند
- ✅ داشبورد مقادیر KPI صحیح را نمایش می‌دهد
- ✅ محاسبه درآمد خالص و پرداخت مربیان با لینک‌های قابل ردیابی کار می‌کند
- ✅ تمام لیست‌ها صفحه‌بندی و جستجو دارند
- ✅ UI واکنش‌گرا + حالت تاریک
- ✅ لاگ‌های Audit موجود و دقیق هستند

## چک‌لیست تست روی XAMPP

برای اطمینان از این‌که انتقال از Docker به XAMPP کامل و بدون مشکل انجام شده است، موارد زیر را در مرورگر تست کنید:

1. **ورود و خروج**
   - به آدرس `http://localhost/sports-camp/public/` (یا `http://sports-camp.local/`) بروید.
   - با کاربر `admin / admin123` وارد شوید.
   - یک‌بار خروج (Logout) را امتحان کنید و دوباره وارد شوید.

2. **دانش‌آموزان**
   - یک دانش‌آموز جدید ثبت کنید.
   - او را در لیست جستجو کنید.
   - ثبت‌نام او را تمدید کنید و مطمئن شوید تاریخ و مبلغ درست ذخیره شده است.

3. **مربیان**
   - یک مربی جدید با زمان‌های کلاس مختلف اضافه کنید.
   - مطمئن شوید تعداد دانش‌آموزان و درآمد مربی به‌درستی در صفحه مربیان نمایش داده می‌شود.

4. **هزینه‌ها و اجاره**
   - یک هزینه‌ی جدید ثبت کنید.
   - صفحه اجاره را باز کرده و ببینید هزینه‌های مربوطه نمایش داده می‌شوند.

5. **گزارش‌ها و داشبورد**
   - داشبورد را بررسی کنید تا KPIها (تعداد دانش‌آموزان، درآمد، هزینه، درآمد خالص) منطقی باشند.
   - گزارش ماهانه و گزارش مربیان را باز کنید و چند فیلتر مختلف را امتحان کنید.

6. **آپلودها و فاکتورها**
   - یک فاکتور تولید کنید و مطمئن شوید فایل در مسیر `public/assets/invoices` ساخته شده است.
   - اگر آپلود فایل دارید، یک فایل تست آپلود کنید و ببینید در `public/assets/uploads` ذخیره می‌شود.

اگر در هر مرحله خطا یا صفحه سفید دیدید، لاگ‌های Apache و PHP را در XAMPP بررسی کنید:
- `xampp/apache/logs/error.log`
- `xampp/apache/logs/access.log`

## توسعه‌های آینده

- [ ] PDF Generation با TCPDF برای فاکتورها
- [ ] یکپارچه‌سازی WhatsApp Business API
- [ ] نمودارها و تجسم داده‌ها
- [ ] اعلان‌های Push
- [ ] پشتیبانی چند زبانه

## مجوز

این پروژه برای استفاده در اردوگاه‌های ورزشی طراحی شده است.

## پشتیبانی

برای سوالات و مشکلات، لطفاً issue ایجاد کنید یا با تیم توسعه تماس بگیرید.

---

**نسخه:** 1.0.0  
**تاریخ:** 1403

